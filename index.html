<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OVERPACK Cloud | Founder Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #050505; color: #f8fafc; overflow-x: hidden; }
        
        /* –°—Ç–µ–∫–ª—è–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç */
        .glass { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.05); }
        
        /* –ö–Ω–æ–ø–∫–∏ –ü–ò–ù-–∫–æ–¥–∞ */
        .pin-btn { width: 70px; height: 70px; background: #111; border: 1px solid #222; border-radius: 50%; font-size: 1.5rem; transition: 0.2s; }
        .pin-btn:active { background: #6366f1; transform: scale(0.9); }
        
        /* –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ñ–∏–ª–∏–∞–ª–æ–≤ */
        .branch-btn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
        .branch-btn.active { background: #6366f1; color: white; box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); border-color: #6366f1; }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è "Live" —Ç–æ—á–∫–∏ */
        .pulse-green { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); animation: pulse 2s infinite; }
        @keyframes pulse { 70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }
        
        #app-content { display: none; } /* –°–∫—Ä—ã—Ç–æ –¥–æ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è */
    </style>
</head>
<body>

    <div id="lock-screen" class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-[#050505]">
        <div class="text-center mb-10">
            <h1 class="text-5xl font-extrabold tracking-tighter mb-2">OVERPACK<span class="text-indigo-500 italic">.</span></h1>
            <p class="text-slate-600 uppercase tracking-[0.3em] text-[10px] font-bold">Secure Cloud Access</p>
        </div>
        
        <div id="pin-dots" class="flex gap-5 mb-10">
            <div class="w-4 h-4 rounded-full border-2 border-slate-800 transition-all"></div>
            <div class="w-4 h-4 rounded-full border-2 border-slate-800 transition-all"></div>
            <div class="w-4 h-4 rounded-full border-2 border-slate-800 transition-all"></div>
            <div class="w-4 h-4 rounded-full border-2 border-slate-800 transition-all"></div>
        </div>

        <div class="grid grid-cols-3 gap-5">
            <button class="pin-btn" onclick="addNum('1')">1</button><button class="pin-btn" onclick="addNum('2')">2</button><button class="pin-btn" onclick="addNum('3')">3</button>
            <button class="pin-btn" onclick="addNum('4')">4</button><button class="pin-btn" onclick="addNum('5')">5</button><button class="pin-btn" onclick="addNum('6')">6</button>
            <button class="pin-btn" onclick="addNum('7')">7</button><button class="pin-btn" onclick="addNum('8')">8</button><button class="pin-btn" onclick="addNum('9')">9</button>
            <button class="text-rose-500 font-bold" onclick="clearPin()">C</button>
            <button class="pin-btn" onclick="addNum('0')">0</button>
            <button class="text-emerald-500 font-bold" onclick="validatePin()">GO</button>
        </div>
    </div>

    <div id="app-content" class="min-h-screen p-4 md:p-8 max-w-7xl mx-auto">
        
        <div class="flex flex-col md:flex-row gap-4 mb-8">
            <div id="btn-shop" onclick="switchBranch('Shop (–ñ—É–±–∞–Ω–æ–≤—ã—Ö)')" class="branch-btn active flex-1 glass p-4 rounded-2xl flex items-center gap-4">
                <div class="w-12 h-12 rounded-xl bg-indigo-500/20 flex items-center justify-center text-indigo-400 text-xl"><i class="fas fa-store"></i></div>
                <div><p class="font-bold">SHOP</p><p class="text-[10px] opacity-60">–ñ—É–±–∞–Ω–æ–≤—ã—Ö 292/1</p></div>
            </div>
            <div id="btn-lounge" onclick="switchBranch('Lounge (–ú–æ–ª–¥–∞–≥—É–ª–æ–≤–æ–π)')" class="branch-btn flex-1 glass p-4 rounded-2xl flex items-center gap-4">
                <div class="w-12 h-12 rounded-xl bg-slate-800 flex items-center justify-center text-slate-400 text-xl"><i class="fas fa-couch"></i></div>
                <div><p class="font-bold">SHOP x LOUNGE</p><p class="text-[10px] opacity-60">–ú–æ–ª–¥–∞–≥—É–ª–æ–≤–æ–π 3</p></div>
            </div>
        </div>

        <div class="flex justify-between items-end mb-8">
            <div>
                <h2 id="branch-title" class="text-3xl font-extrabold text-white mb-1">OVERPACK SHOP</h2>
                <span class="flex items-center gap-2 text-xs font-bold text-emerald-400 bg-emerald-500/10 px-2 py-1 rounded w-fit">
                    <span class="w-2 h-2 rounded-full bg-emerald-500 pulse-green"></span> LIVE CONNECTED
                </span>
            </div>
            <div class="text-right">
                <p class="text-slate-500 text-[10px] uppercase font-bold tracking-widest">–í–´–†–£–ß–ö–ê –°–ï–ì–û–î–ù–Ø</p>
                <h1 id="stat-revenue" class="text-4xl font-black text-white tracking-tighter">0 ‚Ç∏</h1>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass p-6 rounded-3xl">
                <p class="text-slate-500 text-xs font-bold uppercase mb-4">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–ø–ª–∞—Ç—ã</p>
                <div class="flex items-end gap-2 h-20">
                    <div id="bar-kaspi" class="bg-rose-500 rounded-t-lg flex-1 transition-all" style="height: 0%"></div>
                    <div id="bar-cash" class="bg-emerald-500 rounded-t-lg flex-1 transition-all" style="height: 0%"></div>
                </div>
                <div class="flex justify-between mt-2 text-[10px] font-bold">
                    <span class="text-rose-400">KASPI QR</span><span class="text-emerald-400">–ù–ê–õ–ò–ß–ù–´–ï</span>
                </div>
            </div>

            <div class="glass p-6 rounded-3xl">
                <p class="text-slate-500 text-xs font-bold uppercase mb-2">–ü–ª–∞–Ω –ø—Ä–æ–¥–∞–∂ (200k)</p>
                <h3 id="goal-percent" class="text-3xl font-black mb-2">0%</h3>
                <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                    <div id="goal-bar" class="bg-indigo-500 h-full transition-all" style="width: 0%"></div>
                </div>
            </div>

            <div class="glass p-6 rounded-3xl relative overflow-hidden">
                <i class="fas fa-wallet absolute -right-5 -bottom-5 text-8xl text-slate-800 opacity-50"></i>
                <p class="text-slate-500 text-xs font-bold uppercase mb-2">–î–µ–Ω–µ–≥ –≤ –∫–∞—Å—Å–µ</p>
                <h3 id="stat-cash-box" class="text-3xl font-black text-emerald-400">0 ‚Ç∏</h3>
                <p class="text-[10px] text-slate-400 mt-1">–° —É—á–µ—Ç–æ–º –≤–Ω–æ—Å–æ–≤ –∏ –≤—ã–µ–º–æ–∫</p>
            </div>
        </div>

        <div class="glass p-6 rounded-3xl">
            <h3 class="text-sm font-bold uppercase tracking-widest mb-6 border-b border-slate-800 pb-2">–õ–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π</h3>
            <div id="event-logs" class="space-y-4 max-h-64 overflow-y-auto">
                <p class="text-slate-500 text-sm text-center">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
            </div>
        </div>
    </div>

    <script>
        // --- ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò (–í–°–¢–ê–í–¨ –°–í–û–ò –ö–õ–Æ–ß–ò –°–Æ–î–ê) ---
        const SUPABASE_URL = "https://yvlcdmjvwrhjljvrqrzx.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl2bGNkbWp2d3JoamxqdnJxcnp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MDEyMDYsImV4cCI6MjA4NjM3NzIwNn0.ppYr9QI5oe5bUQdD0NwRLhT1KGPcvV5pzKYgCRFywZY";
        // ----------------------------------------------

        const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let currentPin = "", activeBranch = "Shop (–ñ—É–±–∞–Ω–æ–≤—ã—Ö)";

        // --- –õ–û–ì–ò–ö–ê –ü–ò–ù-–ö–û–î–ê ---
        function addNum(n) {
            if(currentPin.length < 4) { currentPin += n; updateDots(); }
        }
        function updateDots() {
            document.querySelectorAll('#pin-dots div').forEach((d,i) => {
                d.style.background = i < currentPin.length ? '#6366f1' : 'transparent';
                d.style.borderColor = i < currentPin.length ? '#6366f1' : '#1e293b';
            });
        }
        function clearPin() { currentPin = ""; updateDots(); }
        function validatePin() {
            if(currentPin === "0000" || currentPin === "1111") {
                document.getElementById('lock-screen').style.display = 'none';
                document.getElementById('app-content').style.display = 'block';
                loadData(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –≤—Ö–æ–¥–µ
            } else { alert("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!"); clearPin(); }
        }

        // --- –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –§–ò–õ–ò–ê–õ–û–í ---
        function switchBranch(name) {
            activeBranch = name;
            // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            document.getElementById('btn-shop').className = name.includes("Shop") ? "branch-btn active flex-1 glass p-4 rounded-2xl flex items-center gap-4" : "branch-btn flex-1 glass p-4 rounded-2xl flex items-center gap-4";
            document.getElementById('btn-lounge').className = name.includes("Lounge") ? "branch-btn active flex-1 glass p-4 rounded-2xl flex items-center gap-4" : "branch-btn flex-1 glass p-4 rounded-2xl flex items-center gap-4";
            
            document.getElementById('branch-title').innerText = name.includes("Shop") ? "OVERPACK SHOP" : "OVERPACK LOUNGE";
            loadData();
        }

        // --- –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –ò–ó SUPABASE ---
        async function loadData() {
            if(SUPABASE_URL.includes("–¢–í–û–ô")) return; // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—É—Å—Ç–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞

            const today = new Date().toISOString().split('T')[0];

            // 1. –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–¥–∞–∂–∏
            const { data: sales } = await sb
                .from('sales')
                .select('*')
                .eq('branch', activeBranch)
                .gte('time', today);

            // 2. –ü–æ–ª—É—á–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –¥–µ–Ω–µ–≥
            const { data: flows } = await sb
                .from('cash_flows')
                .select('*')
                .eq('branch', activeBranch)
                .gte('time', today);

            if(!sales || !flows) return;

            // –†–∞—Å—á–µ—Ç—ã
            let totalRev = 0, kaspi = 0, cash = 0;
            sales.forEach(s => {
                totalRev += s.total;
                if(s.payment_type === 'kaspi') kaspi += s.total;
                if(s.payment_type === 'cash') cash += s.total;
            });

            // –†–∞—Å—á–µ—Ç –¥–µ–Ω–µ–≥ –≤ –∫–∞—Å—Å–µ (–ù–∞–ª –ø—Ä–æ–¥–∞–∂–∏ + –í–Ω–æ—Å—ã - –í—ã–µ–º–∫–∏)
            let cashBox = cash;
            flows.forEach(f => {
                if(f.type === 'in') cashBox += f.amount;
                if(f.type === 'out') cashBox -= f.amount;
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            document.getElementById('stat-revenue').innerText = totalRev.toLocaleString() + " ‚Ç∏";
            document.getElementById('stat-cash-box').innerText = cashBox.toLocaleString() + " ‚Ç∏";
            
            // –ì—Ä–∞—Ñ–∏–∫–∏
            const max = Math.max(kaspi, cash) || 1;
            document.getElementById('bar-kaspi').style.height = (kaspi / max * 100) + "%";
            document.getElementById('bar-cash').style.height = (cash / max * 100) + "%";
            
            // –¶–µ–ª—å (–ü–ª–∞–Ω 200 000)
            const goal = Math.min((totalRev / 200000) * 100, 100).toFixed(1);
            document.getElementById('goal-percent').innerText = goal + "%";
            document.getElementById('goal-bar').style.width = goal + "%";

            // –õ–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π (–°–º–µ—à–∏–≤–∞–µ–º –ø—Ä–æ–¥–∞–∂–∏ –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏)
            const allEvents = [
                ...sales.map(s => ({ time: s.time, msg: `üí∞ –ü—Ä–æ–¥–∞–∂–∞: ${s.total} ‚Ç∏`, color: 'emerald' })),
                ...flows.map(f => ({ time: f.time, msg: `${f.type==='in'?'üü¢ –í–Ω–æ—Å':'üî¥ –í—ã–µ–º–∫–∞'}: ${f.amount} ‚Ç∏ (${f.comment})`, color: f.type==='in'?'emerald':'rose' }))
            ].sort((a,b) => new Date(b.time) - new Date(a.time));

            document.getElementById('event-logs').innerHTML = allEvents.map(e => `
                <div class="flex gap-4 items-center">
                    <div class="w-2 h-2 rounded-full bg-${e.color}-500"></div>
                    <div>
                        <p class="text-sm font-bold text-slate-200">${e.msg}</p>
                        <p class="text-[10px] text-slate-500">${new Date(e.time).toLocaleTimeString()}</p>
                    </div>
                </div>
            `).join('');
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(loadData, 30000);
    </script>
</body>
</html>